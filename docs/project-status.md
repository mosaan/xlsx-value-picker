# xlsx-value-picker プロジェクト現状と作業計画

## 1. 現状の概要

xlsx-value-pickerプロジェクトは、Excelファイルからの値取得、バリデーション、および様々な形式での出力機能を提供することを目的としています。現在のプロジェクト状況は以下の通りです：

### 1.1 ドキュメント整備状況
- [要件定義書](requirements.md): 作成済み
- [CLIインターフェース仕様](cli-spec.md): 作成済み
- [ディレクトリ構造定義](directory-structure.md): 作成済み
- [技術選定ドキュメント](technology-selection.md): 作成済み
- [プロジェクト現状文書](project-status.md): 作成済み
- [バリデーション設計ドキュメント](validation-design.md): 作成済み
- [Mermaidスタイルガイド](mermaid-style-guide.md): 作成済み
- [CLI実装計画](cli-implementation-plan.md): 作成済み

### 1.2 実装状況

- 基本的なCLIフレームワーク: **Clickライブラリを用いたスケルトン実装完了**（CLI仕様に準拠）
- Excelファイルからの値取得機能: 一部実装済み
- YAML/JSON出力機能: 実装済み（ただし仕様に完全には一致していない）
- Jinja2テンプレートによる出力機能: 実装済み（ただし仕様に完全には一致していない）
- バリデーション機能: **未実装**（設計は完了）

### 1.3 現状の課題

1. ドキュメントと実装の不一致
   - ~~CLIインターフェース仕様と実際の実装が完全に一致していない。また、技術選定で検討した`Click`ライブラリを使用していない。~~ -> CLIインターフェースは仕様に準拠したスケルトン実装が完了（Clickライブラリを採用）
   - 要件定義書に記載されたバリデーション機能が未実装

2. テスト整備の不足
   - 単体テストが一部のみ実装されている状態
   - 統合テスト・E2Eテストが未整備

3. ユーザー向けドキュメントの不足
   - インストール方法の詳細説明
   - 設定ファイルの記述例
   - 使い方のチュートリアル

## 2. 作業計画

以下の順序でプロジェクトを進めていきます：

### フェーズ1: ドキュメント完備と実装の方針確定（現在）

- [x] 基本的なドキュメント整備
- [x] プロジェクトの現状と計画の文書化（本ドキュメント）
- [x] 実装方針の詳細検討と文書化（バリデーション設計ドキュメント、Mermaidスタイルガイド）
- [ ] スキーマ定義の見直し・拡充

### フェーズ2: コードベースの見直しと再構築

- [x] 現在のコードベースの全体見直し
- [x] CLIインターフェース実装の修正・仕様との整合性確保（Clickライブラリ採用）
- [ ] 既存機能（Excelファイルからの値取得、出力機能）とClickベースのCLI実装の統合
- [ ] テスティングフレームワークの整備
- [ ] コア機能のテストカバレッジ向上

### フェーズ3: バリデーション機能の実装

- [x] バリデーションエンジンの設計と実装計画
- [ ] ルール定義のパーサーの実装
- [ ] 各種ルール（compare, required, any_of, all_of, not, regex_match, enum）の実装
- [ ] バリデーション結果の出力機能

### フェーズ4: ユーザビリティ向上

- [ ] エラーメッセージの改善
- [ ] ユーザードキュメントの整備
- [ ] サンプルおよびチュートリアルの作成
- [ ] READMEの充実

### フェーズ5: リリースと継続的改善

- [ ] バージョン管理の徹底
- [ ] CI/CDパイプラインの整備
- [ ] リリースプロセスの確立
- [ ] フィードバックの収集と継続的な改善

## 3. 次のタスク

短期的に着手するタスクは以下の通りです：

1. **CLIスケルトンと既存機能の統合**
   - Click対応CLIスケルトンに既存の機能を統合する
   - Excelファイルからの値取得機能とCLIの連携
   - 出力機能（JSON/YAML/Jinja2）のCLI経由での実行サポート
   
2. **バリデーション機能の実装開始**
   - バリデーションエンジンの基本構造の実装
   - ルールクラス階層の実装
   - 単純なルール（Compare, Required）から実装開始

3. **テスト環境整備**
   - CLIインターフェースのテスト追加
   - バリデーション機能のテストケース作成
   - サンプルExcelとルール定義の準備
   - テスト自動化の整備

## 4. 注意事項

- **ドキュメントと実装の一致**: CLIインターフェースは仕様に準拠したClick対応のスケルトン実装が完了しました。引き続き、ドキュメントと実装の整合性に注意が必要です。

- **ドキュメント間の整合性維持**: 複数のドキュメントで同じ内容を記述している箇所があるため、更新時は関連するすべてのドキュメントを確認し、整合性を保つことが重要です。

- **Mermaid図表の構文**: ドキュメント内のMermaid図表を編集する際は、`mermaid-style-guide.md`に記載されているガイドラインを遵守してください。

- **API安定性**: 初期バージョンのリリースまではAPIの変更が頻繁に行われる可能性があります。

- **依存関係管理**: 依存パッケージのバージョン固定が必要です。uv（Pythonパッケージマネージャー）を使用して依存関係を管理しています。

## 5. 今後の展望

- GUIによるルール定義支援ツールの開発
- Webインターフェースの提供
- 他のスプレッドシート形式（CSV、Google Spreadsheetsなど）への対応
- プラグインシステムによる拡張性の向上
- ルールのリアルタイム検証機能の提供（Excel VBAとの連携など）

---

最終更新日: 2025年4月19日