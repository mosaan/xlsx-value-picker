# activeContext.md

## 現在の作業フォーカス
- コア関数の型アノテーション付与・CLI分離・ライブラリ化を実施し、外部Pythonプログラムからもimport可能な構造へリファクタリング済み
- mypyによる型チェックを導入し、型安全性を強化
- テスト・CI/CD・パッケージ構成も整理され、CLI/サブプロセス/ライブラリ両対応の設計が完成
- すべてのテストがパスし、開発・配布・CI/CDの一貫性が確保されている
- Excel値をJinja2テンプレートと組み合わせて任意のテキスト形式で出力する新機能の設計を開始
- テンプレートは外部ファイル指定またはYAML内直接記載の両方に対応する方針
- 出力先はCLIの--outputオプションで指定（YAML内でのoutput_file指定は不要）
- 既存のExcel値抽出・型安全設計・テスト自動化・ドキュメント重視の方針を継続

## 直近の変更
- src/xlsx_value_picker/cli.pyのコア関数に型アノテーションを追加
- CLI専用処理をmain関数・if __name__ == '__main__'以下に分離
- __init__.pyでコア関数を明示的に公開
- mypy導入・型エラーなしを確認
- テスト・CI/CD・パッケージ構成を整理し、全テストがパス
- シートインデックス指定（*N記法）、名前付きセル取得、テーブル・範囲抽出、空行スキップ仕様を実装
- ドキュメント・サンプル・READMEを拡充
- .gitignoreやCI設定の追加・修正
- Jinja2テンプレートによる自由テキスト出力機能の要件・YAML定義案を策定

## 次のステップ
- ドキュメント・サンプルのさらなる充実
- ユーザー要望やフィードバックへの対応
- Jinja2テンプレート出力機能の実装方針をsystemPatterns.mdに整理
- CLI・内部処理の設計・実装
- テスト・ドキュメントの拡充

## アクティブな意思決定・考慮事項
- ライブラリとしてのAPI設計・型安全性を重視
- CLI/サブプロセス/テスト/外部importすべてに対応する構造を維持
- ドキュメント・サンプルの拡充でユーザー体験向上を目指す

## 出力フォーマット指定の方針
- これまでCLIの`--format`オプションで出力フォーマット（json/yaml）を指定していましたが、今後は設定ファイル（YAML）側で`output.format`として管理する方針に移行します。
- CLIの`--format`オプションは将来的に廃止予定です（現状は互換のため残存）。
- Jinja2テンプレート出力なども含め、すべての出力形式は設定ファイルで一元管理します。

## 学び・インサイト
- mypy等の型チェックツール導入で品質・保守性が向上
- ドキュメント・実装・テストの一貫性維持が重要
